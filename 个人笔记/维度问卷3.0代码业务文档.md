<center><h1>维度问卷3.0业务文档</h1></center>

## 一、业务流程（以维度问卷为例）

​	维度问卷3.0项目可适用两大业务场景，涵盖不定项调查（问卷系统）和定向调查（直报系统），下面分别对两大系统进行说明。

说明之前首先对维度问卷系统主要存在的角色做一个罗列

| **角色** | **部门主管**                                                 | **普通用户** | **协管员** | **调查员** |
| -------- | ------------------------------------------------------------ | ------------ | ---------- | ---------- |
| 系统管理 | 添加、修改用户、重置密码                                     | 无           | 无         | 无         |
| 问卷系统 | 问卷管理、调查员管理、问卷进度、下发任务、发布问卷、二维码管理、答卷审核、数据分析、任务管理 | 同左         | 同左       | 同左       |
| 直报系统 | 直报管理、名录库管理                                         | 同左         | 同左       | 无         |

- 部门主管和普通用户的区别：
  - 权限不同，部门主管可以对部门成员进行新增和密码重置；
  - 查看数据范围不一样：部门主管可以查看所辖部门所有成员的所有问卷，但是不能编辑、删除。普通用户只能对自己心间的问卷进行编辑；
- 协管员：权限和问卷、直报的创建者一样，可以对问卷、直报进行编辑、发布、审核；
- 质控人员：可配置部分，需要问卷创建者/问卷协管员添加质控员为问卷协管员，质控人员方可进行质量控制；



### 1、问卷系统

#### （1）问卷系统主流程

![](https://raw.githubusercontent.com/Rainchen0504/picture/master/202202242026259.png)

- 用户新增问卷，编辑设置好问卷题目信息；
- 用户设置协管员，协管员权限与问卷创建者相同；
- 用户新增并设置问卷调查员；
- 用户发布问卷；
- 用户为调查员提供调查必须的资料：调查员账号与调查员二维码；
- 调查员登录调查员h5，开始调查，完成问卷并上传答卷；或直接让被调查对象直接扫码填报问卷；
- 用户对问卷进行审核；
- 用户停止问卷，调查结束；



#### （2）问卷系统管理端

##### （1）系统登陆部分

问卷系统推荐使用谷歌浏览器打开，同时接入了叮叮数据，公司内部人员可以使用钉钉账号登陆。

首次登陆时有设置强制修改密码，新旧密码不能相同，。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202231559324.png" alt="image-20220223154649233" style="zoom:50%;" />

##### （2）创建问卷

问卷的新增目前设置了三种方式，即普通新增问卷、从模板新增、复制问卷。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202231559813.png" alt="image-20220223155011569" style="zoom:50%;" />

##### （3）问卷编辑

问卷编辑分为两种情况：

- 未发布的问卷：新增问卷即进入编辑页面；问卷列表点击编辑进入；

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202231559563.png" alt="image-20220223155637317" style="zoom:50%;" />

- 已发布的问卷：首先要停发布，才能进行编辑操作；

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202231559526.png" alt="image-20220223155651767" style="zoom:50%;" />

###### 1、问卷编辑-挨个新增

在问卷编辑页面，点击【题型】，即可加入对应的题目。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202231610041.png" alt="image-20220223161014127" style="zoom:50%;" />

###### 2、问卷编辑-批量新增

点击批量新增题目，查看批量新增操作说明，在弹窗中按规定格式编写题目内容，系统便可拆分字符串生成对应题目信息。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202231614164.png" alt="image-20220223161405603" style="zoom:50%;" />

###### 3、问卷编辑-逻辑设置

通过显示逻辑按钮可进入逻辑设置弹窗，在该弹窗中可以对单选题、多选题和下拉题设置控制逻辑。实际效果为当选中选项设置了关联题目，就可将选中选项显示，反之未选中就是对关联题目设置隐藏。

⚠️注意：**<font color=red>显示隐藏逻辑不支持跨页配置；显示隐藏结果以最后一次操作选项影响结果为准。</font>**

![image-20220223173955011](/Users/rain_chen/Library/Application Support/typora-user-images/image-20220223173955011.png)

<img src="/Users/rain_chen/Library/Application Support/typora-user-images/image-20220223174016813.png" alt="image-20220223174016813" style="zoom:67%;" />

###### 4、问卷编辑-题目位置移动

每个题目都具有相对当前位置的上移选项，可自由控制选中题目要移动的位置。

⚠️注意：<font color=red>**当题目上移后，上移题目的控制和被控制逻辑都会被清除**</font>

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202241752162.png" alt="image-20220224175204409" style="zoom:50%;" />

##### （4）问卷管理

在问卷管理页面，点击问卷管理可进入到管理问卷的页面。在管理问卷中可执行设置调查员、协管员、问卷发布、问卷审核等工作。

问卷的管理（也包括问卷的编辑）仅允许问卷创建者、协管员进行操作，上级领导可以查看，但是不支持其对问卷流程（编辑问卷、设置协管员、调查员、问卷发布等）进行操作。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202241758643.png" alt="image-20220224175755669" style="zoom:50%;" />

公开问卷，会将问卷公开至公共模板库，公共模板库允许其他用户复制问卷

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202251001592.png" alt="image-20220225100114131" style="zoom:50%;" />



###### 1、问卷进度

问卷进度页面分为填报进度和按任务分配统计填报数两个模块，两个模块均使用Echarts图标直观的显示任务进度。

填报进度中可以并查看调查员的任务完成情况，包括问卷总体的填报进度，查看任务总数和已完成问卷数和未完成任务数。

按任务分配统计填报数中，可以查看已完成问卷中调查员的答卷完成数、完成答卷占比、调查任务完成率。同时还可以选择图表的类型，从而更直观的查看数据展示情况。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202241847319.png" alt="image-20220224184717100" style="zoom:50%;" />

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202241847088.png" alt="image-20220224184743973" style="zoom:50%;" />

###### 2、设置协管员

可以在设置协管员页面，勾选用户为问卷的协管员，可让协管员享有问卷创建者的权限，为问卷创建者分担问卷管理任务。（协管员为所有问卷管理平台使用者，即所有公司员工与外部用户，其中只有部门主管可新增外部用户）

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202250912472.png" alt="image-20220225091211334" style="zoom:50%;" />

###### 3、设置调查员

可以在设置调查员页面，勾选调查员为问卷的调查员，给调查员分配具体的调查任务与任务数。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202241851956.png" alt="image-20220224185138645" style="zoom:50%;" />

###### 4、发布问卷

进入发布问卷页面后，可以点击【发布】，即可发布问卷。发布状态的问卷，会将调查员的调查任务和调查任务数下发给调查员，可以通过勾选是否限定填报IP来限制受访者可以填报的份数。发布问卷的总份数最多为99999份，下发给调查员的问卷份额总数加和等于发布问卷的总份数。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202241857530.png" alt="image-20220224185731226" style="zoom:50%;" />

###### 5、二维码管理

在二维码管理页面，会呈现问卷调查员的二维码，可以方便调查员为被调查对象提供二维码或H5链接，让被调查对象直接填报问卷。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202241858005.png" alt="image-20220224185805826" style="zoom:50%;" />

###### 6、答卷管理

问卷采集端填报答卷后，用户可以做在答卷管理页面即可看到问卷的答卷。答卷管理页面支持问卷创建者及协管员对问卷进行查看答卷、查看定位、审核。

在答卷管理页面，点击【查看】即可打开查看页面，查看具体答卷内容与答卷录音；点击【定位】即可打开定位弹窗，查看调查时调查员的定位。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202250904849.png" alt="image-20220225090420543" style="zoom:50%;" />

此外，答卷管理页面支持对单个答卷进行审核和对答卷进行批量审核。（1）对单个答卷进行审核。在答卷管理页面，点击“审核”即打开审核页面，还可查看具体答卷内容与答卷录音，并对答卷进行审核。（2）还可在列表页进行够选或全部批量审核通过或驳回。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202250902188.png" alt="image-20220225090244693" style="zoom: 33%;" />

如果题目中存在附件等附加内容，可通过勾选具体答卷或全部答卷进行附件和录音的导出。当审核查看完成后，可将当前问卷导出成Execl，打包下载。

###### 7、数据分析

在该页面可以查看问卷的答题情况，并按审核状态、调查员等属性对调查结果进行分析。其中，数据分析只针对**单选题 、多选题 、下拉题 、量表题 、矩阵单选 、矩阵多选 、矩阵量表**进行分析，分析结果生成柱状图和饼图展示。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202250905453.png" alt="image-20220225090516625" style="zoom:50%;" />



### 2、直报系统

#### （1）直报系统主流程

![](https://raw.githubusercontent.com/Rainchen0504/picture/master/202202231425949.png)

- 用户新增直报，编辑好直报题目；
- 用户设置协管员，协管员权限与问卷创建者相同；
- 用户新增并设置被调查对象名录，确定调查对象类型；
- 用户发布问卷；
- 用户为被调查对象提供必须的资料：被调查对象账号与直报地址；
- 被调查对象登录直报h5，开始填报，提交直报问卷；
- 用户对直报问卷进行审核，审核通过，被调查对象直报任务完成；审核驳回，被调查对象需要重新填报直报问卷，只有填报答卷审核通过后，直报任务才算完成；
- 用户停止问卷，调查结束；



#### （2）直报系统管理端

##### （1）新增直报

直报问卷新增分为3种：新增、从模板新增、复制。与问卷不同的点在于，新增复制时，需要设置直报的调查类型。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202251333073.png" alt="image-20220225133339549" style="zoom:50%;" />

##### （2）直报编辑

直报编辑状态下，单个新增、批量新增题目，设置显示隐藏逻辑，题目位置移动等同问卷保持一致。

##### （3）直报管理

用户在直报管理页面，点击【管理直报】，可进入管理直报的页面。在管制直报中可进行设置协管员、被调查对象名录、直报发布，直报审核的工作。

直报的管理（也包括问卷的编辑）仅允许问卷创建者、协管员进行操作，上级领导可以查看，但不支持其对直报流程进行操作，如编辑直报问卷，设置协管员、被调查对象名录、直报发布，直报审核等流程。

###### 1、填报进度

用户可以在填报进度页查看直报问卷的填报进度。与问卷页面保持一致。

###### 2、设置协管员

用户可以在设置协管员页面，勾选用户为直报问卷的协管员，可让用户享有问卷创建者的权限，为问卷创建者分担问卷管理任务。（用户为所有问卷管理平台使用者，即所有公司员工与外部用户）

###### 3、名录管理

与问卷不同的是，用户管理中设置被调查对象的名录清单分为企业样本名录和个人样本名录。同时，支持新增、文件导入、名录导入这三种添加方式。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202251121443.png" alt="image-20220225112121474" style="zoom:50%;" />

单个新增和文件导入的新调查对象均会记录在系统名录中，可在名录库管理中同步查找。

未发布的直报问卷支持用户切换被调查对象类型，即可在企业和个人样本名录之间切换，但是切换的同时会**清空调查对象清单**。

###### 4、开网管理

用户可以在开网管理页面，填写开始填报时间、截止时间等，点击【发布】，即可发布直报问卷。发布状态的问卷，会将调查任务下发给被调查对象。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202202251334423.png" alt="image-20220225133429842" style="zoom:50%;" />

###### 5、数据管理和数据分析

- 直报采集端填报答卷后，用户可以做在数据管理页面即可看到直报问卷的答卷。
- 数据管理页面支持直报问卷创建者及协管员对直报问卷进行查看答卷、审核。
- 数据管理页面支持对单个直报答卷进行审核和对答卷进行批量审核。
- 用户可以在数据分析页面查看问卷的答题情况，并对调查结果进行分析。



### 3、采集端

#### （1）业务流程

问卷部分：

![image-20220330181639654](https://raw.githubusercontent.com/Rainchen0504/picture/master/202203301816936.png)

直报部分：

![image-20220330181627057](https://raw.githubusercontent.com/Rainchen0504/picture/master/202203301816548.png)

#### （2）直报H5

- 登录账号

被调查对象企业和个人账号均由问卷管理平台新增，个人账号微手机号，企业账号为组织机构代码。

![image-20220330183646780](https://raw.githubusercontent.com/Rainchen0504/picture/master/202203301836787.png)

- 填报及提交

直报H5首页会显示被调查对象的所有需要填报的问卷。被调查对象可以在首页选择一份未完成的问卷，点击打开填报页面并填写直报问卷。

![image-20220330184147977](https://raw.githubusercontent.com/Rainchen0504/picture/master/202203301841288.png)

用户点击【暂存】按钮，即暂存填报数据，暂存的问卷保存在首页的直报列表中，用户可以继续填报。

当完成必填的内容时，点击【提交】上传问卷到后台，完成一份直报问卷的提交。首页的直报列表中，对应的直报状态由未完成变更为审核中。等待问卷管理平台用户对直报进行审核。
![image-20220330184322653](https://raw.githubusercontent.com/Rainchen0504/picture/master/202203301843947.png)

- 审核驳回

管理端用户对直报进行审核，通过流程结束，驳回则提交的问卷由审核中变为驳回

![image-20220330184606133](https://raw.githubusercontent.com/Rainchen0504/picture/master/202203301846273.png)

点进问卷，首行显示驳回意见

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202203301846736.png" alt="image-20220330184649347" style="zoom:50%;" />

用户再次填报提交后问卷状态由驳回变为待审核。



#### （3）问卷H5

- 登录账号

调查员可使用手机号+密码进行登录，调查员账号由问卷管理平台新增。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202203301827532.png" alt="image-20220330182731648" style="zoom:50%;" />

- 调查及提交

H5首页会显示调查员的所有需要调查的问卷，点击【立即调查】即打开问卷填写页面，填写问卷。用户在问卷填写页面完成必填的内容，点击【提交】，即可完成一份问卷调查。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202203301831538.png" alt="image-20220330183103711" style="zoom:50%;" />

完成的答卷可以在查看答卷中查看完成的答卷数据。



## 二、代码部分（以专项调查平台和维度问卷为例）

### 1、项目代码结构

![image-20220721095539074](https://raw.githubusercontent.com/Rainchen0504/picture/master/202207211138845.png)



管理端



填报端



#### ques-core部分

##### 目录

![image-20220721100610874](https://raw.githubusercontent.com/Rainchen0504/picture/master/202207211138160.png)

##### 模板部分

模板部分包含题型新增页面和h5、pc预览页面的静态结构

![image-20220721100821144](https://raw.githubusercontent.com/Rainchen0504/picture/master/202207211138799.png)

##### js部分

包含样式图标的css文件、图片img文件、js文件。配题页面所有题型均由js目录下sub文件中的js动态生成；而预览回显时结构部分由java目录下的subject文件生成，但逻辑和方法由js目录下的js提供。

![image-20220721104135539](https://raw.githubusercontent.com/Rainchen0504/picture/master/202207211138478.png)

​		所有题型如下：

![image-20220721110629107](https://raw.githubusercontent.com/Rainchen0504/picture/master/202207211138977.png)

##### 流程说明

- 新增题目页面

此时进入`ques_add.html`，该页面负责引入题型及通用方法文件，同时创建了问卷标题、顶部操作按钮的dom结构和相关方法；

![image-20220721113727247](https://raw.githubusercontent.com/Rainchen0504/picture/master/202207211138971.png)

- 新增题目（以单选题举例）

新增单选题时，即将`chose.js`文件中的选择题基类`ChoseClass`实例化

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202207211141802.png" alt="image-20220721114129788" style="zoom: 50%;" />



























### 3、H5

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202203311017083.png" alt="image-20220331101736089" style="zoom:67%;" />



### 4、管理端

![image-20220331103150061](/Users/rain_chen/Library/Application Support/typora-user-images/image-20220331103150061.png)

