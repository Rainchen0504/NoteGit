# 跑马灯迁移千机

## 一、需求地址

https://tapd.woa.com/Securities_products/prong/stories/view/1020404382116928333

https://tapd.woa.com/Securities_products/prong/stories/view/1020404382117450366



## 二、需求概述

将老运营平台系统中的跑马灯模块迁移至千机系统，接口数据等采用无极表的形式存储，审批流、列表操作依赖无极平台的能力；

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202405211146228.png" alt="image-20240521114649725" style="zoom:40%;" />



## 三、迁移前地址

页面布局参考旧系统

https://wzqoms.woa.com/ad/index.html#/marketrest



## 四、业务流程

**迁移前**

![image-20240517122002047](https://raw.githubusercontent.com/Rainchen0504/picture/master/202405171220312.png)

**迁移后**

![image-20240517122016651](https://raw.githubusercontent.com/Rainchen0504/picture/master/202405171220094.png)



## 五、数据结构

无极表字段结构设计

| 字段名            | 含义                 | 数据类型 | 备注                                                         |
| ----------------- | -------------------- | -------- | ------------------------------------------------------------ |
| id                | 数据标识ID           |          | 自增ID                                                       |
| type              | 跑马灯类型           | number   | 1--休市提醒，2--其他提醒                                     |
| appid             | 平台                 | json     | [wzq、app、wzqxcx、zxgxcx、mini_h5、oem]，支持多选           |
| comm_title        | 外显通用标题         | string   |                                                              |
| before_rest_title | 外显休市前标题       | string   |                                                              |
| resting_title     | 外显休市中标题       | string   |                                                              |
| notice_title      | 公告标题             | string   |                                                              |
| contents          | 内容                 | string   |                                                              |
| begin_time        | 公告留存开始时间     | string   | 时间戳                                                       |
| end_time          | 公告留存结束时间     | string   | 时间戳                                                       |
| permanent         | 是否长期有效         | number   | 1--有效，0--无效                                             |
| rest_period       | 休市日期和时间       | json     | [{"rest_begin_time": "休市开始时间（时间戳）","rest_end_time": "休市结束时间1（时间戳）"，"halfday":"是否勾选半天（布尔值）"},{......}] |
| daily_begin_time  | 每日曝光时段开始时间 | string   | HH:mm:ss结构                                                 |
| daily_end_time    | 每日曝光时段结束时间 | string   | HH:mm:ss结构                                                 |
| is_trade_day      | 每日曝光是否是交易日 | bollean  | true--是交易日，false--不是交易日                            |
| wzq_link          | 微证券跳转链接       | string   |                                                              |
| zxg_link          | 自选股跳转链接       | string   |                                                              |
| wzqxcx_link       | 微证券小程序跳转链接 | string   |                                                              |
| zxgxcx_link       | 自选股小程序跳转链接 | string   |                                                              |
| oem_link          | oem跳转链接          | string   |                                                              |
| market            | 市场                 | string   | 沪深--hs、港股--hk、美股--us                                 |
| scene             | 投放页面             | json     | ["zixuan","gegu","hushen_lv2","gangutong_tab","beixiangzijin"…]<br />（共有：自选首页、个股详情页、沪深lv2页、港股通TAB、北向资金、港股非lv2） |
| stock             | 投放个股信息         | json     | [{"market":"投放市场","target_stockcode":["投放股票代码1","投放股票代码2"…],"not_target_stockcode":["不投放股票代码1","不投放股票代码"…]}] |
| ~~act_mode~~      | ~~交互方式~~（移除） | number   | 0--跳转，1--弹窗                                             |
| ~~abt_info~~      | ~~abt信息~~（移除）  | string   | {"layer_id":"层id","param_name":"参数名","param_val":"参数值"} |
| status            | 状态                 | number   | 0--草稿，1--审核中，2--已上线，3--审核驳回，4--已下线，5--暂停（保留） |
| holiday_open_time | 节假日开市时间       | string   | 时间戳                                                       |
| holiday_name      | 节假日名称           | string   |                                                              |
| holiday_day       | 节假日日期           | string   | 时间戳                                                       |
| oem_dealer        | oem券商代码          | string   |                                                              |
| notice_note       | 公告备注内容         | string   |                                                              |
| old_condition     | 投放条件（版本号等） | string   | ["1001:1:4:ios=1.1.0&android=1.2.0","1032:2:1:0"]            |
| approval_id       | 审批单ID             | string   | 查询审批状态用                                               |
| approval_notice   | 审批通知信息         | json     | 存储审批通知信息用（也用来存储保存信息）                     |
| create_user       | 创建人               | string   |                                                              |
| create_time       | 创建时间             | string   |                                                              |
| modify_user       | 修改人               | string   |                                                              |
| modify_time       | 修改时间             | string   |                                                              |
| audit_user        | 审核人               | string   |                                                              |
| audit_time        | 审核时间             | string   |                                                              |



## 六、系统结构

![千机新增一级菜单跑马灯配置](https://raw.githubusercontent.com/Rainchen0504/picture/master/202405231142577.png)

- 系统入口：千机系统左侧菜单创建一级入口--跑马灯管理，二级入口--休市公告提醒和其他提醒
- 休市公告管理和其他提醒两个模块页面结构基本相同，区别在以下几点：
  - 1、新增弹窗中，**休市公告管理不区分平台，只区分市场，而其他提醒中区分平台，并未区分市场**；
  - 2、新增弹窗中，休市公告管理相比其他提醒，增加休市日期时间、开市时间、节假日、节假日日期、备注属性配置，其他属性无异；
  - 3、新增弹窗和属性列中，其他提醒相比休市公告，增加各平台跳转链接配置；
  - 4、新增弹窗中，休市公告投放位置仅包含个股详情和自选首页，而其他提醒中页面则区分个股详情、自选首页、港股通TAB等等页面；
  - 5、新增弹窗中，其他提醒当平台选择APP时，需要增加投放版本配置项；
- 审批流程需要在千机平台维护，需要重新确认审批流程；



## 七、注意点

1、建两张表，正式表和开发表，测试环境也采用开发表；

2、重点需做好测试和落表数据校验；

3、休市公告提醒和其他提醒模块较相似，尽量使用lesscode实现代码复用功能；

4、在老系统中需要增加引导提示至新系统；

