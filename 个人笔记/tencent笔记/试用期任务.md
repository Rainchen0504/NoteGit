| 时间            | 目标                                                         | 主要事项                                                     |
| --------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 第一周 - 第二周 | 1、熟悉 activity ，act 活动仓库；<br>2、学习证券开发规范，值班操作手册 | 1）熟练使用代理工具whister、nohost<br>2）掌握蓝盾流水线发布规范<br>3）完成 福利中心，猜涨跌活动主流程的梳理，iwiki 输出活动交互流程图<br>4）完成 福利中心，猜涨跌活动 性能瓶颈分析<br>5）掌握营销中台活动配置化方法，组件开发方法 |
| 第三周 - 第四周 | 掌握平台研效工具                                             | 1）掌握图片发布平台，无极，千机投放平台的使用<br>2）掌握用例设计的基本方法，掌握组件库单元测试的设计方法，掌握UI自动化测试用例的开发和设计方法<br>3）掌握组件hel化的实现方案 <br>4）熟悉无极文档，掌握无极2.0平台二次开发的能力 |
| 第五周 - 第六周 | 参与年底活动开发，熟练掌握证券研发流程                       | 1）熟练使用前四周学习的各项工具和规范<br>2）高效协作，高质量协助完成年底活动的开发上线 |

前置配置：设置腾讯源npm、安装证书设置whister、node安装14.20、tnpm要求7以上

```shell
npm install @tencent/tnpm@7 -g --registry=http://r.tnpm.oa.com --verbose
nvm install 14.20
```



# 第一周--第二周

# 1、whistle代理工具

​	类似nginx转发机制，将本地启动的项目地址和访问的目标地址同时代理到whistle服务上，如本地8899端口，从而实现移动端同域访问和抓包等功能

```shell
# 安装
npm install -g whistle
# 启动
w2 start
# 重启
w2 restart
# 停止
w2 stop
```

## 1.1、PC端

1. 默认无法捕获HTTPS请求，因此点击HTTPS按钮下载安装证书，并设置信任证书

2. 进入终端中的`127.0.0.1:8899`域名，配置`rules`，不同项目不一样，根据代码仓库指示地址配置

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311081729370.png" alt="image-20231108172929076" style="zoom:50%;" />

   1. act项目：`/(wzq|zqact(0[1-6])?).\w+(.com|.cn){1,}/(activity)/ 127.0.0.1:8082 log://act whistle.inspect://vConsole`
   2. activity项目：`/(zxg|zqact01|zqact|zqact02|zqact03|wzq)\.(txfund|tenpay).*\.(com|cn)\/(activity)\//  127.0.0.1:5173 disable://cache`

3. 进入Network所属Tab，查看抓包结果，查看Inspector部分进行调试

   1. Request请求头、请求体等

      <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311081730241.png" alt="image-20231108173006661" style="zoom:50%;" />

   2. Response响应头、响应体等

      <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311081730789.png" alt="image-20231108173025393" style="zoom:50%;" />

## 1.2、移动端

1. 手机wifi设置手动代理，输入启动whistle终端的域名和端口号
2. 使用浏览器或微信扫码或访问rootca.pro安装并信任证书
3. 访问地址，如：
   1. act项目：`https://zqact.tenpay.com/activity/page/guessRiseFall/#/index`即可在PC端看到抓包结果
   2. activity项目：`https://zqact.tenpay.com/activity/page/testdemo1/#/index`即可在PC端看到抓包结果



# 2、nohost代理工具

## 2.1、PC端

1. 申请权限，打开`https://stockfe-proxy.woa.com/data.html`代理配置页面

2. 设置抓包环境为`spd_develper`和对应环境

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311081746416.png" alt="image-20231108174559670" style="zoom:50%;" />

3. 在rules中配置预发布地址，规则和whislte相同



## 2.2、移动端

1. 开启Moa的远程办公，在Moa查找nohost，配置代理为`stockproxy`

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311081736061.png" alt="image-20231108173542481" style="zoom: 20%;" />

2. 打开微证券地址

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311171143922.png" alt="image-20231108174124453" style="zoom:20%;" />

3. 设置小蓝点抓包环境和PC端地址相同，然后就可以在PC端`Network`看到抓包结果

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311081751403.png" alt="image-20231108175113873" style="zoom:50%;" />



# 3、蓝盾发布流水线

## 3.1、券前端小助手方式

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311081612114.png" alt="image-20231108154459652" style="zoom: 50%;" />

1. 企业微信搜索添加stockfe-helper证券前端小助手

2. 查看我的需求和管理需求

3. 点击版本启动

   1. Tapd --> 选择对应需求，一个需求一个版本
   2. Git --> 选择仓库代码，如微证券act
   3. 分支 --> 分支名称，使用`feature/`开头才会触发发布流程，默认是用时间创建
   4. 提交后会自动创建分支，如`feature/activity_115032590_1108`

4. 在IDE中切换到创建的分支，做需求开发

5. 可以修改`.devops-ci.yml`文件配置实现流水线流程更变

   ```yml
   build:
     page: guessRiseFall # 活动名称, 对应page目录下的活动目录名称，只能写一个，多个只会跑第一个
     test: true # 是否需要测试，免测版本直接走发布流程，非免测版本测试通过后再走发布流程
     planners: llvyhuang #产品人员，多个以,分割，免测需求可以为空
     chatid: ww58626947229545 #需求群ID，免测需求可以为空，在群中@小助手：群id 可获取
     testers: llvyhuang #测试人员，多个以,分割，免测需求可以为空
     reviewers: mandydyluo,teffyliu,galeqin,qiqijhliu,hobbyye,jaymelv,zhiruizhang # mr审核人员，多个用,分割
     approvers: taylenxu # 发布审批人，多个用,分割
     feature: 【技术优化需求】福利中心文案优化 # 需求特性, 可以为空，不写会用最近的git commit信息
     tapds: "1020404382115032590" #TAPD需求ID，多个以,分割，免测需求可以为空
     developers: rainchzhang # 开发者
   ```

6. 修改代码，`git push`进行提交

7. 小助手会提示启动流水线任务，点击进入链接

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311081613414.png" alt="image-20231108161319729" style="zoom:50%;" />

8. 自动化执行发布流程

   初始化流水 -> codecc -> 开发审核、产品体验 ->  测试审核、部署测试环境 -> 自动合并代码到发布分支、发布审核  -> 发布通知、自动化测试

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311081621944.png" alt="image-20231108162007015" style="zoom:50%;" />

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311081621222.png" alt="image-20231108162022742" style="zoom:50%;" />

9. 总结需求生命周期

   1. 获取需求
   2. 拉取分支，进行需求开发
   3. 提交需求发起自动化流水线
   4. 读取配置是否免测
   5. 如果免测，直接搭配进入mr合并流程
   6. 如果需要测试，则进行开发审核、产品体验、测试审核和测试环境部署验证
   7. 进入mr合并流程，判断是否通过合并审核
   8. 没通过重新重新进入到开发流程，通过则将分支合并到发布分支
   9. 发布审核，没通过就进行代码回退，通过则发布上线
   10. 需求结束



# 4、act仓库

## 4.1、猜涨跌

### 4.1.1、活动进入方式

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311091557838.png" alt="image-20231109155719700" style="zoom:50%;" />



### 4.1.2、修改配置文件

修改`.devops-ci`文件中的page属性为`guessRiseFall`，然后npm run serve运行，再打开链接`https://zqact.tenpay.com/activity/page/guessRiseFall/#/index`



### 4.1.3、路由信息

#### （1）父路由

`router/route.config.ts`文件路由信息中`page/guessRiseFall`为猜涨跌

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311091104176.png" alt="image-20231109110431422" style="zoom:50%;" />



#### （2）子路由

下辖16个子路由，其中`Page.vue`为默认页面

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311091105957.png" alt="image-20231109110538515" style="zoom:50%;" />



### 4.1.4、模块结构

#### （1）图解分析

##### 1、页面图示

![draw](https://raw.githubusercontent.com/Rainchen0504/picture/master/202311101100449.svg)

##### 2、交互图示

![猜涨跌Index.vue](https://raw.githubusercontent.com/Rainchen0504/picture/master/202311101410898.svg)



#### （2）代码逻辑

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311091833611.png" alt="image-20231109141620865" style="zoom: 25%;" />

##### 1、Page.vue页面

1. 引入`plugin/index.js`文件，给Vue实例上挂载openShareCard分享卡片组件、openModal弹窗组件、toast组件等方法组件
2. 设置路由前置守卫判断当前域名前缀，替换`wzq.tenpay.com`为`zqact.tenpay.com`
3. 下一步进入默认子路由`Index.vue`页面

##### 2、Index.vue页面

1. 组件创建前`beforeCreate`：remove掉Storage中的缓存

2. 组件创建后`created`：控制页面`scroollTo`滚动到（0,0），获取每日任务vtools配置(不确定用法)

3. 组件挂载前`beforeMount`：绑定事件，如果当前页面被隐藏触发埋点统计

4. 组件挂载后`mounted`：

   1. 获取登录状态，判断是否登录

      1. 如果没登录，就根据当前`navigator`环境对象，登录微信、QQ或APP自选股
      2. 如果已经登录，进行下一步

   2. 获取当前用户全部信息`userAllInfo`

   3. 判断渠道来源，如果从理财通进入标题为“腾讯理财通”，否则为“全民猜涨跌”

   4. 执行`getHomedata`方法

      1. 请求获取猜涨跌主页数据

      2. 判断竞猜状态，，显示5天的竞猜数据或当前竞猜对象

      3. 给页面使用到的其他数据从请求数据中赋值，包括涨跌猜测占比、感兴趣的股票列表、是否新人等

      4. 获取全局vtool配置以及滚动swiper弹幕、竞猜排行、用户话题等数据

      5. 根据后台返回的标识控制展示新人奖励弹窗

         如果已竞猜，根据后台返回竞猜结果展示竞猜结果弹窗

   5. 根据运行平台QQ、微信、自选股APP等不同平台初始化分享配置

5. 页面交互（从上到下）

   1. 点击规则触发`jumpRules`方法，跳转至`strategy`组件页面，该页面为两个tab的静态页面，对活动进行说明
   2. 点击活动弹幕触发`scrollEvent`方法，会滚动到下面的社区话题位置
   3. 点击k线图会展示当前点位指数
   4. 点击查看详情触发`seeDetails`方法，前往股票信息页面
   5. 点击看涨、看跌分别触发`bullishBtn`和`bearishBtn`方法，发起请求并修改猜测状态
   6. 邀请好友，区分APP、小程序等不同平台调用匹配的分享方法
   7. 感兴趣股票展示`getHomedata`方法中获取到的30条股票数据，一次展示6条，点击换一批修改渲染内容索引，点击去竞猜触发`goJingCai`方法进入对应股票社区
   8. 点击查看我的个股竞猜记录触发`readStock`方法，跳转至home组件页面，展示竞猜结果列表
   9. 大家怎么看模块，点击单个看涨或看跌观点，触发`goDetailPage`方法进入对应观点详情页面，点击我看涨或跌则触发`prePostComment`方法进入个人观点评论页面，可编写个人观点
   10. 竞猜榜单模块，点击历史战绩跳转至home组件页面，展示竞猜结果列表，点击更多榜单触发`goViewMore`事件进入rank组件页面，展示总竞猜榜单和月记录榜单
   11. 点击去兑换触发`goExchange`方法进入金币商城页面



### 4.1.5、总结

存在不使用的冗余代码以及组件耦合较重的情况：

1. 模板部分
   1. 存在较多的v-if判断，通过询问黄玉有些条件基本不存在使用，模板部分代码还存留，导致代码过长维护困难；
   2. 注释较少，同时class和v-on绑定的属性有的已经废弃还未删除；
2. 逻辑部分
   1. data和methods中存在有废弃没用的属性和方法未清除；
   2. script中存在重复引入，如在外层Page.vue文件或根页面中引入了plugin/index在index中又重复引用了一遍等；
   3. data中存在有重复声明变量的情况；
   4. 数据处理重复部分没有提出来封装，有一些数据处理逻辑可以抽离出来写成工具函数；
   5. 生命周期中存在重复调用方法和初始化数据的操作，如created中初始化滚动位置操作了两次等；



## 4.2、福利中心

### 4.1.1、活动进入方式

猜涨跌为福利中心的一个活动，所以进入方式基本相同



### 4.1.2、修改配置文件

修改`.devops-ci`文件中的page属性为`welwareCenterNew`，然后npm run serve运行，再打开链接`https://zqact.tenpay.com/activity/page/welwareCenterNew/#/index`



### 4.1.3、路由信息

#### （1）父路由

`router/route.config.ts`文件路由信息中`page/welwareCenterNew`为福利中心

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311101704895.png" alt="image-20231110170359214" style="zoom:50%;" />



#### （2）子路由

下辖3个子路由，其中`index.vue`为默认页面

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311101704790.png" alt="image-20231110170434145" style="zoom:50%;" />



### 4.1.4、模块结构

#### （1）图解分析

##### 1、页面图示

![](https://raw.githubusercontent.com/Rainchen0504/picture/master/202311101800978.svg)

##### 2、交互图示

![福利中心Index.vue](https://raw.githubusercontent.com/Rainchen0504/picture/master/202311101704803.svg)



### 4.1.5、总结

页面内容相对猜涨跌较少，内容展示比较灵活，除固定显示内容外大部分都是条件控制的弹窗组件

1. 模板部分
   1. 注释较全面，各个模块都是用组件封装好，部分内容实用动态组件components灵活显示；
   2. 存在在模板标签中写逻辑和配置对象的问题，尽量提取到computed或data中；
2. 逻辑部分
   1. data和methods中存在有废弃没用的属性和方法未清除；
   2. 初始化数据时，存在重复逻辑；
   3. 函数命名和属性定义存在不规范现象；
   4. 初始化数据dataInit函数中部分逻辑应提取出来放入组件内部执行，保证函数功能单纯性；



# 5、性能分析

​	通过使用webpack-bundle-analyzer插件对项目包体进行可视化呈现，以及对控制台中network资源加载情况进行时间排列，并有针对性的阅读代码后，对福利中心和猜涨跌活动性能问题提出以下改进方案：

## （1）福利中心

### 1、打包情况

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311171147801.png" alt="202311162051392" style="zoom: 15%;" />

### 2、请求情况

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311162102731.png" alt="image-20231116205147851" style="zoom: 25%;" />

### 3、首次内容绘制到最大内容绘制时长

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311162153883.png" alt="image-20231116215304201" style="zoom:50%;" />



## （2）猜涨跌

### 1、打包情况

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311162102712.png" alt="image-20231116210129522" style="zoom: 15%;" />

### 2、打包情况

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311162112993.png" alt="image-20231116210405782" style="zoom: 25%;" />

### 3、首次内容绘制到最大内容绘制时长

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311162147504.png" alt="image-20231116214734664" style="zoom:50%;" />



## （3）可提升修改点

### 1、网络

1. 将vue、vue-router、vuex使用cdn的方式引入到index.html中，不编译到vendor.js中，这样浏览器可以使用多个线程异步将vendor.js、外部的js等加载下来，达到加速首开的目的；
2. lottie-web可以改用https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.12.2/lottie.min.js链路下的min版本，相比直接直接引入lottie版本体积更小；
3. 项目中存在，比如接口请求后缓存了，在一些场景切换中又重复请求；以及在一些根本没用到该接口的其它页面，也请求了接口；等重复冗余请求的情况，因此需要减少不必要的 HTTP 请求节省请求等待时间，毕竟一个完整的 HTTP 请求需要经历连接与释放过程会占用进程和时间；
4. 开启HTTP2进行请求，对请求尽量都采用HTTP2进行请求，解析速度更快，可以有效降低延迟，提升请求速度；
5. homeData数据请求时间过长，可能是sql查询较复杂导致，在之后的开发中协商是否可以拆分homeData的数据，对不常改变的数据请求设置 HTTP 缓存，提高加载速度；

### 2、图片

1. img标签未做处理，可以设置懒加载的方法，先不给图片设置 src 路径，监听图片出现在浏览器可视区域时，才去加载图片；
2. 对图片进行压缩，对较小的图片转为base64的格式，减少图片资源请求；

### 3、减少打包体积

1. stat、sdk等方法函数在根目录中的main.ts、App.vue和welwareCenterNew组件中的index.vue都引入了一遍，增加了编译时长和包体大小；
2. 查看analysis分析结果，request.js、guessAPI.js等包至少被重复打包3次以上，无形中增加了包体大小；
3. lottie.js包可以改为采用异步加载的方式，虽然在welwareCenterNew组件的index.vue文件中初始化时就引入了OldWithNewPopup组件，但是lottie动画只在满足特定条件切触发receiveHB方法时才会使用，因此可以在初次加载时不使用import引入，改为满足条件时懒加载使用，可以减少包体大小；
4. 对于stockfe-ui组件库尽量使用按需引入的方法引入，减少包体大小；
5. 将stockfe-hq-chart等工具包下载到本地，使用require按需引入的方式引入，如果直接在全局引入包体显然较大，造成请求时间较长；
6. 可以使用`IgnorePlugin`插件，只保留loadsh或第三库中需要用到的包，忽略掉其他的包，减少包体大小；
7. 对vendors.js包使用splitChunks进行分包，拆解成一个个的小包并使用Gzip压缩，减小包体大小的同时也能借用HTTP2的多虑复用特性提高加载速度；

### 4、CSS

1. 规范类名，方便修改和查找时候不容易产生混淆；
2. 项目存在使用通配符和属性选择器的行为，应尽量避免使用，因为元素匹配消耗的时间更长，需要尽量避免使用；
3. 对于部分动画可以使用transforms 和 opacity 这两个属性替代，因为这两个属性不会触发重排与重绘；

### 5、渲染优化

1. 需要对元素进行复杂操作时，可以先隐藏元素（display:none）操作完成后再显示
2. 合理使用 requestAnimationFrame 代替 setTimeout
3. 合理使用nextTick替代setTimeout
4. 项目组件中存在部分事件绑定可以使用事件委托的方式编写，不仅可以减少注册事件的个数，减少methods方法个数还能提高性能减少内存占用；
5. 应及时清除定时器，项目中大量使用了定时器setTimeout进行事件处理和重新渲染，因此需要排查避免内存泄漏；

### 6、更新依赖包版本

1. 根据项目需要可以适当更新依赖包版本，因为包体更新一般都会做出优化迭代，可能会减少体积优化性能；
2. 项目依赖的webpack版本还是4版本，可以酌情考虑升级使用5版本，相比先前版本，webpack5做出了很多优化，如更好的 Tree Shaking 能力、降低产物资源的缓存失效率、通过持久化硬盘缓存能力来提升构建性能等等，可以有效提高项目打包效率和构建速度，减少项目体积大小；

### 7、去除生产环境日志

1. 自定义日志打印类，在生产环境默认关闭，但可通过浏览器参数打开；
2. 或者安装`uglifyjs-webpack-plugin`插件控制调试日志打印；



# 6、活动配置和组件开发方法

**activity**项目是替代act仓库开发的运营活动仓库，可多端在公众号、小程序和APP展示

## （1）创建项目

在activity项目中通过package.json中的create指令创建新项目，创建流程如下图

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311141155558.png" alt="image-20231114115503811" style="zoom:67%;" />

创建完成后会在activitiy项目目录下生成模板子项目

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311151640886.png" alt="image-20231115164048618" style="zoom:50%;" />

## （2）组件开发

activity的活动项目在开发的过程中，不可避免的会使用到封装的公共或定制化组件，主要类型有以下两种：

- 项目包含的components或其他文件目录下开发的组件
- 通过资源包@tencent安装引入的组件

### 1、项目本体组件

该类组件通常被定义在项目的components目录下，如周一抢牛活动中的红包弹窗redbagPopup组件、提现承接弹窗withdrawal组件等，通常这类组件都**与业务密切相关，属于定制化组件**，不具备通用性，只是为了<font color=deepred>减少代码的耦合度，使主页面组件和主逻辑保持清晰</font>。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311141648101.png" alt="image-20231114164813311" style="zoom: 67%;" />



### 2、资源包组件

#### （1）activity-core组件库

该类组件属于通用组件，在**activity-core组件库项目中开发**，该库包含支持APP、H5、小程序的组件

- activity-core组件库结构划分：

  ![activity-core组件库](https://raw.githubusercontent.com/Rainchen0504/picture/master/202311142100512.svg)

#### （2）组件开发

1. 首先根据具体业务场景和组件的复杂度，进入对应的文件目录下

2. 开发业务组件，构思好组件的封装内容和prop参数的设计

   1. 如果开发的内容为通用组件包@tencent/st-act-common-ui，对应activity-core项目中的st-act-common-ui目录，创建新的组件名称目录，编写index.vue即可，还可以将请求api也封装进组件中；
   2. 如果开发的内容为通用方法包@tencent/st-act-common，对应activity-core项目中的st-act-common目录，在src目录下创建新的方法名称目录，编写index.ts，可以使用类封装或函数封装，使用时
      1. 引入工具类，创建实例调用；
      2. 引入export导出的方法，直接调用；
   3. 如果开发的内容为模板组件包@tencent/st-act-template，对应activity-core项目中的st-act-template目录，在src目录下创建新的组件名称目录，然后以index.vue为根组件进行开发，此处主要开发的是相对复杂和功能较全面的大型组件；

3. 开发中台可配置组件

   在业务组件开发的基础上，还需要在activity-core项目的activity-prom文件目录下创建同名文件名，编写index.ts，该文件主要导出两个对象，一个是可配置属性config对象，一个是组件对象component；

#### （3）组件发布

组件开发完成后，提交代码，自动触发流水线发布流程

1. **对于业务组件**
   - 发布完成后，会自动更新npm源仓库中的版本号，先前的版本也会保留
   - 在项目中引用新开发的组件时，需要手动更新package.json文件中组件包的版本号，然后`tnpm i`重新安装后使用；
2. **对于中台可配置业务组件**
   - 首先会自动更新npm源仓库中的版本号，然后判断：
     - 如果activity-prom目录下的组件有新增，会自动映射更新在fit平台的组件列表中；
     - 如果只是对现有prom目录下的组件进行修改，fit平台组件库对应组件也会自动更新至最新版本；

#### （4）流程图示

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311151526049.png" alt="image-20231115152629768" style="zoom:50%;" />

### 3、运营中台使用

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311151632044.svg" alt="运营中台使用" style="zoom: 50%;" />



# 7、值班操作手册

1. 9点前签到，在群中发布签到文案；
2. 按照规定顺序进行功能验证：
   1. 对最近一次发版功能进行验证，如果存在阻碍主流程的情况，联系版本负责人进行回退处理；
   2. 对照证券业务核心文档中二组（增长）P0级核心功能进行走查；
   3. 对照反馈群中提出的问题验证功能；
   4. 对照监控群和值班群告警机器人的预警提示
3. 按照增长方向模板汇报值班结果，说明异常；
4. 全天开启消息提示，关注外部反馈和告警；



# 8、证券开发规范

### （1）需求评审

使用`TAPD`平台接收需求，理解需求内容；

### （2）开发准备

- 正式开发前还需要再次确认需求文档的完整性、设计稿和后台接口由谁给出，当前完成度是否支持开发；
- 对于困难或核心需求还需要联合相关人员进行方案评审和技术选型；
- 确定开发任务后，对开发计划进行拆解排期，保证功能进度可控；

### （3）正式开发

- 使用stockfe-helper证券前端小助手基于master创建本次功能开发分支；
- 编码环节：
  - 代码格式：开启prettier本地工作区检查，开启eslint校验，开启git增量检查等；
  - 代码质量：
    - 1.严格遵守[javascript](https://git.woa.com/standards/javascript)和[css](https://git.woa.com/standards/css)语法规范
    - 2.规范变量和方法命名
    - 3.减少冗余和垃圾代码，边界条件考虑全面
    - 4.及时清除绑定和定时器等，减少内存泄漏
- 开发过程中如果遇到需求变更或冲突等情况应及时向上反馈，**保留责任人的沟通记录**，方便事后进行环节追溯
- 功能开发完成后及时进行自测，如果后台无法及时提供数据，主动mock数据自测也可以找同事帮忙体验
- 如果有较复杂逻辑可以申请同上级和同事进行代码CR，吸取他人意见提高代码质量

## （4）联调

获取后台接口进行调试，需要注意同后台的沟通方式

## （5）测试

通过开发者、产品经理、测试人员等测试环节，该环节注意记录测试者提出的意见和bug内容，并及时进行修改，避免漏改、错改的情况

## （6）发布

使用蓝盾流水线进行项目自动化发布，通过预发布、灰度和线上三个阶段后发布上线

## （7）回退

**关注证券前端发布群**中发布助手的提示，代码回退的集中情况，可根据具体情况进行回退处理

1. 合并代码时回退

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311171802784.png" alt="image-20231117180245827" style="zoom:25%;" />

2. 发布完成时回退

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311171803258.png" alt="image-20231117180316407" style="zoom:25%;" />

3. 正式环境回退

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311171803999.png" alt="image-20231117180344137" style="zoom:25%;" />

4. 灰度环境回退

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311171804551.png" alt="image-20231117180407710" style="zoom:25%;" />

5. 预发布环境回退

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311171804878.png" alt="image-20231117180430107" style="zoom:25%;" />

6. 每日23:59日版本回退，回退到上一日版本

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311171804676.png" alt="image-20231117180453656" style="zoom:25%;" />

7. 指定版本回退

   在发布平台中可以指定不同环境下项目的指定版本，点击覆盖就可以切换到指定版本





# 第三周-第四周

# 1、图片发布平台

## 1.1、图片管理

该模块类似于图床功能，上传设计好的图片，平台自动生成链接（原图格式或webp格式），开发者直接使用图片链接即可

### （1）创建流程

![图片管理](https://raw.githubusercontent.com/Rainchen0504/picture/master/202311201646133.svg)

### （2）使用方法

在项目中图片、样式中直接使用图片链接即可

```html
<!--在模板中使用-->
<img src="https://st.gtimg.com/design/269a2720ae4aac27c9a095a089ab7908.png"/>
```

```css
/*在样式中使用*/
background: url(https://st.gtimg.com/design/25755b782b17b6a6b6b0dd81f683ec01.png);
```



## 1.2、lottie管理

相比于图片管理，该模块用于管理lottie动画（用json描述动画数据的矢量图）

### （1）创建流程

![lottie管理](https://raw.githubusercontent.com/Rainchen0504/picture/master/202311201725655.svg)

### （2）使用方法

1. 引入lottie模块

   ```js
   import lottie from 'lottie-web';
   ```

2. 创建lottie动画对象，将动画链接设置为**path属性**，

   ```js
   this.flowerLottie = lottie.loadAnimation({
     container: document.getElementById('flower-lottie'), // DOM对象
     renderer: 'svg', // 渲染成svg
     loop: false, // 循环播放
     autoplay: false, // 自动播放
     path: 'https://st.gtimg.com/design/38dbf308b4720b13ef40356358b65399.json', // json动画路径
   });
   ```

3. 动画操作

   ```js
   this.flowerLottie.stop(); // 停止
   this.flowerLottie.play(); // 开启
   ```



# 2、无极平台

​	无极是一个针对管理端开发的集成大量功能模块的低代码平台，可以实现无代码的数据配置和应用搭建工作。针对我的业务范畴，下面只关注证券方向的**活动运营**模块。

## 2.1、功能范畴

​	组内开发任务主要使用的是**数据库管理和接口服务**接入功能，通过<font color=deepred>GUI可视化方式搭建数据表，再以API接口的方式输出</font>。应用时调用API获取数据表对象，将活动配置属性如活动名称、UI属性、活动时长、活动图片等以变量的形式写在代码中，当有改动时无需调整代码，只要在无极平台修改配置就可实现灵活切换的效果，从而提高活动复用性，减少开发成本。



## 2.2、流程图示

![无极平台](https://raw.githubusercontent.com/Rainchen0504/picture/master/202311221552734.svg)



## 2.3、流程说明

1. 打开无极平台，进入证券配置平台模块；

2. 根据业务范畴，展开运营活动分组；

3. 选取运营活动表配置（activity、act代码中活动配置基本归属于此）；

4. 判断是否需要新建数据表；

5. 如果是需要新建表的情况：

   1. 点击左侧树结构顶部的新建表按钮；
   2. 设置表基本信息、权限、安全管控、高级操作等配置；
   3. 设计表结构，定义表头每一个字段的内容和表现形式；
   4. 如果有复杂逻辑还可以配置动作钩子等回调，丰富表功能；
   5. 保存提交，成功创建表；
   6. 然后进入表配置，重复有表情况下的操作；

6. 如果是已有表的情况：

   1. 根据目标数据判断新建或编辑数据行，分别点击新增一行或操作列编辑按钮；
   2. 根据表结构设计的内容，填充数据行信息，注意匹配表字段要求数据格式；
   3. 保存行数据，完成新建修改；

7. 保存发布，完成平台配置；

8. 代码层面，首先import引入无极sdk包

   ```js
   import Wuji from '@tencent/st-wuji-sdk';
   ```

   解析包体内容：

   ```js
   // 入口文件index.ts，从config文件引入createWujieGet方法，定义get方法并导出
   import { createWujieGet } from "./config";
   export const get = createWujieGet(http, aegisReporter);
   export default {
     get
   };
   ```

   ```js
   // config.ts文件，封装createWujieGet函数，内部是封装promise请求返回请求后的值
   export const createWujieGet = (http, aegisReporter) => {
     return function get(params: WujiParams) {
       const obj: WujiParams = { appid: params.appid, schemaid: params.schemaid };
       // 枚举参数，减少参数随机性
       normalKey.forEach((item) => {
         // 如果有传就带上
         if (params[item]) {
           obj[item] = params[item];
         }
       });
       // 带上appkey
       obj.appkey = APP_KEYS[params.appid];
       const queryString = Object.keys(obj)
         .map((item) => `${item}=${obj[item]}`)
         .join("&");
       // 计算fetchkey，用来cos存储兜底
       const fetchkey = md5(queryString);
       const rowString = params.rowid ? `/${params.rowid}` : "";
       const url = `https://${wujiDomain}/wuji/object${rowString}?${queryString}&fetchkey=${fetchkey}`;
       const backupUrl = `https://${wujiBackUpDomain}/__wuji__/api/public/object${rowString}/${obj.appid}/${obj.schemaid}/${fetchkey}.json`;
       const time = Date.now();
       return http
         .get(url)
         .then((res: WujiResponse) => {
           aegisReporter.reportTime("speed", Date.now() - time);
           return res.data;
         })
         .catch(() => {
           aegisReporter.log(`normal_error: ${url}`);
           return http.get(backupUrl).then(res => {
             return {
               ...res,
               code: 200,
             };
           }).catch((error) => {
             aegisReporter.log(`backup_error: ${backupUrl}`);
             return Promise.reject("请求无极配置失败");
           });
         });
     };
   };
   ```

9. 从目标表数据的无极页面路径上获取appid和schemaid；

10. 再从目标表数据行的属性中找出专用的筛选条件属性名和属性值；

11. 组装请求参数

    ```js
    {
      appid: 'act',
      schemaid: 'yy_activity_page_config',
      filter: encodeURIComponent('act_id = zhangyuchentest1'),
    }
    ```

12. 使用sdk提供的get方法传递组装的参数发起请求，获取配置对象

    ```js
    Wuji.get({paramObj})
    ```

13. 本地调试情况下配置whistle代理

    ```shell
    wzqcf.gtimg.com pre-wzq.woa.com reqMerge://(nocache=1) disable://cache
    ```

14. 解构请求数据，业务使用；



# 3、千机平台

​	千机是一个**低代码运营系统**，无需编写代码就可以让产品、运营实现广告、推广信息的投放管理工作。

## 3.1、系统结构总览

该系统是由多个模块组而成的集成系统，根据不同角度：

### （1）按照系统平台分

- 无极证券配置平台，负责搭建运营平台管理端页面布局、数据接口来源、低代码组件管理等

  <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311241559728.png" alt="image-20231124155938803" style="zoom: 33%;" />

- 运营平台管理端，负责根据任务类型、设备类型、推送信息内容位置等不同管理投放信息

  <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311241605689.png" alt="image-20231124160456837" style="zoom:33%;" />

- 客户端组件库，根据客户端具体展现内容的要求，开发对应的组件，供管理端选取最终渲染到用户的推动容器中



### （2）按照工作流程分

- 无极平台数据配置，负责搭建数据表，最终映射到运营平台对应的模块页面中

  <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271049822.png" alt="image-20231127103553491" style="zoom: 33%;" />

- 无极平台应用管理，以低代码的方式配置运营平台的内容结构，并将数据表的内容映射到配置好的页面中

  <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271052282.png" alt="image-20231127105208095" style="zoom:33%;" />

- 运营平台管理端，根据推送任务类型的不同（商城、开户模块、页面选择），使用组件库提供的组件制定投放广告、弹窗等计划和呈现样式

  <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271059798.png" alt="image-20231127105917870" style="zoom:33%;" />

- 客户端组件库（act-premotes仓库），根据展示平台的不同（小程序、公众号、APP）封装具体要呈现的组件样式，供管理端选择

  <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271122011.png" alt="image-20231127112237327" style="zoom: 50%;" />



## 3.2、千机-无极

### （1）数据表配置

​	数据配置模块下存在千机表分组，维护了测试和正式两种环境下不同页面tab下的数据表，这些表会转换成一个个数据接口（统称为无极数据源），通过这些接口可以访问表里的数据。无极数据源中的数据和运营管理端页面的数据是相互关联的，操作后都会自动同步。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271547337.png" alt="image-20231127154717479" style="zoom:50%;" />

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271602151.png" alt="image-20231127160200870" style="zoom:50%;" />

<center>无极数据源和管理端映射关系</center>



### （2）系统搭建

#### 1、应用配置

​	应用管理模块下，根据开发环境进入测试或正式运营平台配置界面

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271621940.png" alt="image-20231127162109714" style="zoom:50%;" />

- 页面列表，管理已有页面及创建新页面

  <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271638596.png" alt="image-20231127163817897" style="zoom: 50%;" />

- 顶部导航，管理顶部导航栏的内容

  <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271652954.png" alt="image-20231127165252241" style="zoom:50%;" />

- 左侧菜单，管理左侧导航菜单内容、层级、页面管理关系

  <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271656567.png" alt="image-20231127165437106" style="zoom: 33%;" />

- 数据源，引入数据配置模块配置的数据表，以及管理数据源的请求形式

  <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271700590.png" alt="image-20231127170024838" style="zoom:50%;" />

#### 2、页面创建

通过<font color=deepred>新增页面</font>或<font color=deepred>进入工作台</font>进入低代码配置平台界面

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271717743.png" alt="image-20231127171703794" style="zoom: 33%;" />

下面以按钮组件举例

1. 从左侧菜单通用组件tab中拖拽组件进入画布

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271813048.png" alt="image-20231127181258338" style="zoom:50%;" />

2. 在右侧菜单属性tab中修改组件基本信息（文本内容、图标、对齐方式等）

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311271815901.png" alt="image-20231127181523909" style="zoom:50%;" />

3. 在右侧菜单样式tab修改组件样式（尺寸、背景、边框等）\

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311272000049.png" alt="image-20231127200046789" style="zoom:50%;" />

4. 在右侧菜单行为tab给组件绑定交互事件及行为步骤

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311272005644.png" alt="image-20231127200546519" style="zoom:50%;" />

5. 如果对组件使用不熟悉，还可以点击右侧菜单的指南查看文档

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311272010088.png" alt="image-20231127200957563" style="zoom:50%;" />

6. 在左侧菜单数据源tab中可以配置无极数据源data、页面自定义变量state、件方法methods、全局实例$app等

   1. 数据源data，获取无极表中的数据，以接口的形式与当前页面中的组件进行关联绑定（通过拖拽与组件绑定）

      <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311272016103.png" alt="image-20231127201622599" style="zoom: 33%;" />

      <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311272019781.png" alt="image-20231127201939417" style="zoom:50%;" />

   2. 自定义数据state，设置当前页面的自定义变量（通过拖拽与组件绑定）

      <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311272021064.png" alt="image-20231127202106595" style="zoom:33%;" />

   3. 事件方法methods，监听数据源的变化，可以在数据初始化或变化时执行目标操作

      ![image-20231127202328993](/Users/rain_chen/Library/Application Support/typora-user-images/image-20231127202328993.png)

   4. 选取数据源时可以以现有数据表作为模板，source对象为当前数据表对象

      ```js
      // 获取数据表对象属性
      source.XX
      // 获取数据表对象方法
      source.$methods.XX()
      ```

7. 在顶部菜单可以执行预览、保存、发布上线等操作

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311272028817.png" alt="image-20231127202801977" style="zoom:50%;" />



## 3.3、千机-管理端

管理端对应运营分析平台，用于管理投放页面、投放位置、投放组件、投放规则等

### （1）投放配置流程

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311281611375.png" alt="image-20231128161128665"  />

### （2）页面说明

​	运营分析平台管理端区分不同环境，并针对不同环境做了数据隔离（测试、正式），但是平台内容大同小异。

#### 1、页面管理

主要用于配置投放的平台、目标页面路径、页面名称等信息

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311281650692.png" alt="image-20231128165040636" style="zoom: 33%;" />

其中个性化参数用于定义页面的特殊参数，会自动生成到对应页面的数据表中；海雀二级分类名则用于调用海雀提供的埋点接口；

#### 2、位置管理

​	指定组件显示位置，如搜索框下面、全局窗帘等，可以理解为选择组件显示位置插槽的过程

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311281704859.png" alt="image-20231128170431607" style="zoom: 33%;" />

其中日曝光次数上限和间隔用来控制该位置的推广内容可以被用户看到几次，即控制指定位置的展示频率；

#### 3、组件管理

​	配置组件的基本信息、接收的数据和样式以及背景缩略图等

通过填写表单，引入组件包和组件名，再配置组件接受的样式和属性参数，从而实现组件库组件的映射调用

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311281713497.png" alt="image-20231128171349199" style="zoom: 33%;" />

#### 4、投放计划管理

​	系统的核心功能，首先选择投放组件和投放位置，然后配置组件对应的文案和内容样式，包括显示频率等，接着预览检查无误后，发起审批上线流程，最终投送到客户端展示

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311281721791.png" alt="image-20231128172126859" style="zoom: 33%;" />



## 3.4、千机-组件开发

​	前端组件库用于开发一些通用推广弹窗、引导按钮、全局窗帘以及偏定制化的龙虎榜、跑马灯等组件。使用规定的语法和通信方式，接收运营平台管理端配置的数据，最终挂载到页面指定位置呈现在用户面前

​	组件开发仓库在`act-premotes`仓库，千机系统要求使用`hel-micro`将组件打包成远程模块才能和系统关联使用。下面以`QianjiSearchAdv`通用广告位组件举例：

```vue
<template>
  <div>
    <div 
      class="delivery-search-adv" 
      :class="[addBottom ? 'delivery-search-adv-mb':'']"
      ref="deliverySearchAdv"
      v-if='showAdv && premoteNew'>
      <div class="search-adv-banner-bg" :style="{backgroundImage: `url(${advPicInfo.bg_pic})`}" @click="clickAdv">
        <div class="search-adv-title-bg">
          <div class="title">{{advTextInfo.main_text}}</div>
          <div class="subtitle">{{advTextInfo.sub_text}}</div>
        </div>
        <div class="search-adv-sc" v-if="advPicInfo.material_pic" :style="{backgroundImage: `url(${advPicInfo.material_pic})`}" ></div>
        <div class="search-adv-button-text" v-else-if="advTextInfo.button_text">{{advTextInfo.button_text}}</div>
        <i class="search-adv--close" v-if="advStyleConfig.can_close == 1" @click.stop="closeAdv"></i>
      </div>
    </div>
  </div>
</template>
<script>  
import * as QIANJI_CONST_KEY from '../utils/config';
import { sessionStorage } from "@tencent/st-storage";

export default {
  props: ['premote'],
  data() {
    return {
      advConfig: null,
      advPicInfo: null,
      advTextInfo: null,
      advStyleConfig: {},
      showAdv:true,
      premoteNew: null,
      addBottom: false,
    };
  }, 
  async mounted() {  
    this.addEvent();
  },
  watch: {
    premote:{
      immediate:true,
      handler(val){
        if (val) {
          this.premoteNew = val; // 监听属性描述对象
          if (val.ad_list && val.ad_list.length > 0) {
            this.advConfig = val.ad_list[0];  
          }
          this.advStyleConfig = JSON.parse(val?.component_param?.component_style?.template);
          this.advPicInfo = this.deliveryFormatPic(this.premoteNew);
          this.advTextInfo = this.deliveryFormatText(this.premoteNew);
          if (this.advStyleConfig?.exp_hold_s) {
            setTimeout (()=>{
              this.showAdv = false;
            }, this.advStyleConfig?.exp_hold_s * 1000)
          }
          this.$nextTick(()=>{
            this.deliveryCheckIntersectionObserver(this, this.$refs.deliverySearchAdv, ()=>{
              this.reportShow();
            })
          })
        }
      }
    }
  },
  methods: {
    // 监听场的事件要求
    addEvent() {
      if (this.$parent && this.$parent.$event) {
        this.$parent.$event.$on('emit_delivery_component_hide', () => {
          this.showAdv = false
        });
        this.$parent.$event.$on('emit_delivery_component_show', () => {
          this.showAdv = true
        });
      }
    },
    reportShow(){
      this.deliveryReportMta(this.$parent, this.premoteNew, 'yy.search.deliverysearchadv_top_brow');
      this.reportQianjiGo(this.$parent, this.advConfig.dp_ctx, 'show');
    },
    closeAdv() {
      this.showAdv = false;
      this.deliveryReportMta(this.$parent, this.premoteNew, 'yy.search.deliverysearchadv_top_close');
      this.reportQianjiGo(this.$parent, this.advConfig.dp_ctx, 'close');
    },
    clickAdv() {
      sessionStorage.setItem(QIANJI_CONST_KEY.QIANJI_HAS_CLICKED_QIANJI_STORAGE_KEY, this.advConfig);
      this.deliveryReportMta(this.$parent, this.premoteNew, 'yy.search.deliverysearchadv_top_click');
      this.reportQianjiGo(this.$parent, this.advConfig.dp_ctx, 'click');
      this.deliveryDoJump(this.$parent, this.premoteNew);
    }
  },
};
</script>
```

1. props接收参数premote，通过watch监听该值，该值包括运营平台管理端组件管理模块配置的属性结构对象等数据；
2. 属性描述对象分为content和style属性，content定义属性表示的类型，style定义属性表示的值，通过查找id可以匹配对应的属性值；
3. 其他行为与正常组件开发无异；
4. 开发组件最终会渲染成DOM元素，然后挂载在预留的DOM元素下；



## 3.5、千机投放全流程图示

![千机管理端](https://raw.githubusercontent.com/Rainchen0504/picture/master/202311291109025.svg)

投放任务流程

![千机客户端](https://raw.githubusercontent.com/Rainchen0504/picture/master/202311291110591.svg)

客户端流程



## 3.6、hel组件

​	hel组件使用了腾讯开源的hel-micro<font color=deepred>**远程模块**</font>技术。该技术提供了一种**运行时引入远程模块**的能力，模块部署在 CDN，远程模块发布后，不需要重新构建发布，就能生效。

<font color=red>**下面以QianjiSearchAdv组件为例**：</font>

### （1）本地开发

1. 拉取act-premotes仓库代码；

2. `npm i`安装依赖；

3. `npm run start`启动项目；

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311291956040.png" alt="image-20231129195600176" style="zoom:50%;" />

4. 自动调用`start:App`指令；

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311291956403.png" alt="image-20231129195647037" style="zoom:50%;" />

5. 修改`COMP`后面的组件名为QianjiSearchAdv；



### （2）本地调试

1. 启动stock微证券项目；

2. 启动act-premotes项目；

3. whistle配置千机项目代理；

   1. Rules配置

      1. stock项目代理

         ```js
         /wzq.(tenpay|gtimg).com\/mp\/v2/ 127.0.0.1:8080 disable://cache
         ```

      2. mock数据文件

         ```js
         /dp_carriers/ resBody://{dp_carriers.fcgi}      statusCode://200 resCors://*
         /dp_report/ resBody://{dp_report.fcgi}      statusCode://200  resCors://*
         /dp_query.*(carrier_id=2&)/ resBody://{dp_query.fcgi}    statusCode://200  resCors://*
         ```

   2. Values配置

      1. dp_carriers数据表

         ```json
         {
             "carrier_infos":[
                 {
                     "ext_params":[
                         "stockcode"
                     ],
                     "id":2,
                     "path":"/search"
                 },
             ],
             "retcode":0,
             "retmsg":"success"
         }
         ```

      2. dp_report数据表

         ```json
         {
             "carrier_infos":[
                 {
                     "ext_params":[
                         "stockcode"
                     ],
                     "id":2,
                     "path":"/search"
                 },
             ],
             "retcode":0,
             "retmsg":"success"
         }
         ```

      3. dp_query数据表

         ```json
         {
             "carrier_id":2,
             "position_dp_list":[
                 {
                     "ad_list":[
                         {
                             "component_param":"{\"component_content\":{\"main_text\":\"起舞！万亿中国银行新高\",\"sub_text\":\"银行股又嗨了！中国银行创历史新高\",\"button_text\":\"点击开户\",\"target_link_type\":3,\"target_link\":\"https://wzq.tenpay.com/mp/v2/index.html#/hot?tab=0&stat=I1111\",\"target_link_ext\":\"\",\"apply_source_type\":\"\",\"apply_source_id\":\"\",\"bg_pic\":\"https://st.gtimg.com/wuji/pics/wzq_operation_test/H1mNYHQJ.png\"},\"component_style\":{\"main_text_limit\":12,\"sub_text_limit\":20,\"button_text_limit\":4,\"template\":\"{\\\"main_text\\\":{\\\"font_size\\\":36,\\\"font_limit\\\":12,\\\"color\\\":\\\"#ffffff\\\",\\\"font_family\\\":\\\"系统默认字体\\\"},\\\"sub_text\\\":{\\\"font_size\\\":24,\\\"font_limit\\\":20,\\\"color\\\":\\\"#ffffff\\\",\\\"font_family\\\":\\\"系统默认字体\\\"},\\\"button_text\\\":{\\\"font_size\\\":24,\\\"font_limit\\\":4,\\\"color\\\":\\\"#461C04\\\",\\\"font_family\\\":\\\"系统默认字体\\\"},\\\"bg_pic\\\":\\\"https://st.gtimg.com/wuji/pics/wzq_operation/rEaDJDBO.png\\\",\\\"can_close\\\":1,\\\"exp_hold_s\\\":30,\\\"sub_style_preview\\\":\\\"\\\"}\"},\"component_info\":{\"name\":\"QianjiSearchAdv\",\"pkg\":\"st-act-premotes\",\"is_across_page_uninstall\":false,\"ext_stat\":\"\",\"container\":\"\",\"position\":\"\"}}",
                             "dp_ctx":"{\"dp_id\":256,\"position_id\":57,\"content_id\":830,\"strategy\":\"static\",\"anti_dup_id\":\"\",\"strategy_info\":\"\",\"preview\":0,\"be_first\":1}",
                             "dp_id":256,
                             "ext_properties":{
                                 "big_news":null,
                                 "curtain_ipo":[
         
                                 ],
                                 "hq_category":0,
                                 "stat":"I5Y01p000a012",
                                 "type":0
                             },
                             "links":{
                                 "target_link":"",
                                 "target_link_ext":"",
                                 "target_link_type": 0
                             },
                             "pictures":{
                                 "ad_pic":"",
                                 "bg_pic":"",
                                 "icon_pic":"",
                                 "material_pic":""
                             },
                             "texts":{
                                 "button_text":"",
                                 "main_text":"",
                                 "sub_text":""
                             }
                         }
                     ],
                     "component_info":"{\"container\":\".yy-adv-delivery-search-container\",\"ext_stat\":\"\",\"is_across_page_uninstall\":false,\"name\":\"QianjiSearchAdv\",\"pkg\":\"st-act-premotes\",\"position\":\"beforeend\"}",
                     "position_id":57
                 }
             ],
             "retcode":0,
             "retmsg":"success"
         }
         ```

4. 打开stock项目中搜索广告位查看调试结果

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311292330331.png" alt="image-20231129233021629" style="zoom:50%;" />

5. 修改act-premotes中的组件代码，stock项目打印生效

   <img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311301126536.png" alt="image-20231130112637665" style="zoom: 33%;" />



### （3）hel-micro

hel帮助我们实现了模块级别的微前端能力，可以将组件、函数等级别的内容作为资源模块引入。

hel最**显著的特点**就是<font color=red>**代码模块消费关系从编译时提升到运行时**</font>，极大提高了动态载入远程模块的灵活性。

#### 1、写法案例

```js
import helMicro from "hel-micro"
export const preFetchLibApi= async (libname) => {
  const comp = await helMicro.preFetchLib("libname")
  return comp
}
```

1. 引入hel-micro模块
2. 通过`helMicro.preFetchLib`拉取要引入的远程模块
3. 调用远程模块

#### 2、托管机制

`hel-micro`拥有**双构建机制**。

1. 使用`rollup`打包本地可静态导入的代理文件，可用于开发时的类型提示；
2. 使用`webpack`打包远程注入的实际运行代码，使用`helMicro.preFetchLib`获取；

​	从而达成可以本地静态导入`node_modules`里的代理模块对象得到完整的类型提示，让用户能得到像使用本地模块一样地使用远程模块的极致开发体验

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311301235019.png" alt="image-20231130123533737" style="zoom: 67%;" />



# 4、持续测试

测试用例编写和管理平台地址：https://ftp.woa.com/p/devops/fwuji/test_tools

该平台提供了测试用例从任务创建 --> 用例设计 --> 用例编写 --> 用例执行 --> 输出报告等测试全流程闭环管理。

## 4.1、用例管理

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311301557250.png" alt="image-20231130155716170" style="zoom:50%;" />

### （1）手工用例

1. 根据业务模块类型，选择对应的用例库，这里选择微证券测试

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202312011145006.png" alt="202312011139791" style="zoom:33%" />

2. 再根据任务类型匹配到对应的文件夹

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202312011139435.png" alt="20231130161504539" style="zoom:33%" />

3. 新建用例，编辑执行步骤或导入附件

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202312011529364.png" alt="202312011528743" style="zoom: 33%;" />

​	

### （2）用力集

用力集是用例的集合，用于可复用用例的管理，可以通过手动和自动添加手工用例中的用例到集合中

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202311301621567.png" alt="20231130162146355" style="zoom:33%" />

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202312011139967.png" alt="20231130162227666" style="zoom:33%" />

### （3）手工用例评审

对编写的用例进行评审，可以使用脑图或列表展示

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202312011139423.png" alt="20231130162929930" style="zoom:33%" />


## 4.2、测试管理

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202312011139513.png" alt="20231130155729107" style="zoom:50%" />

### （1）测试计划

测试计划通过**关联产品需求**，并**绑定执行编写的测试用例**，从而执行测试并追踪测试产生的缺陷。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202312011140531.png" alt="202312011122438" style="zoom: 33%;" />

### （2）测试报告

测试报告用来管理和可视化查看测试计划的结果，并提供报告导出和分享功能。

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202312011116439.png" alt="20231201111623339" style="zoom:33%" />

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202312011140221.png" alt="20231201111645358" style="zoom:33%" />

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>