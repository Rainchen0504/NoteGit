ç¼“å­˜æ·˜æ±°ç­–ç•¥LRUå’ŒLFU

## LRU

â€‹	`Least recently used`æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œå±äºå…¸å‹å†…å­˜ç®¡ç†ç®—æ³•ã€‚è¯¥ç®—æ³•æ ¹æ®æ•°æ®çš„å†å²è®¿é—®è®°å½•æ¥è¿›è¡Œæ·˜æ±°æ•°æ®ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®æœ€è¿‘è¢«è®¿é—®è¿‡ï¼Œé‚£ä¹ˆå°†æ¥è¢«è®¿é—®çš„å‡ ç‡ä¹Ÿæ›´é«˜â€ã€‚

### ç®—æ³•æµç¨‹ï¼š

<img src="https://raw.githubusercontent.com/Rainchen0504/picture/master/202305261629258.png" alt="img" style="zoom:75%;" />

1. å°†æ–°æ•°æ®ä»å°¾éƒ¨æ’å…¥åˆ°`this.keys`ä¸­ï¼›
2. æ¯å½“ç¼“å­˜å‘½ä¸­ğŸ¯ï¼ˆå³ç¼“å­˜æ•°æ®è¢«è®¿é—®ï¼‰ï¼Œåˆ™å°†æ•°æ®ç§»åˆ°`this.keys`çš„å°¾éƒ¨ï¼›
3. å½“`this.keys`å¡«æ»¡ç¼“å­˜æ•°é‡è¾¾åˆ°æœ€å¤§å€¼æ—¶ï¼Œå°†æœ€è¿‘æœ€å°‘è®¿é—®çš„æ•°æ®å‰”é™¤ï¼›



### åº”ç”¨åœºæ™¯

1. keep-aliveå†…ç½®ç»„ä»¶ï¼›
2. åº•å±‚çš„å†…å­˜ç®¡ç†ï¼Œé¡µé¢ç½®æ¢ç®—æ³•ï¼›
3. ä¸€èˆ¬çš„ç¼“å­˜æœåŠ¡ï¼Œredisä¹‹ç±»ï¼›



### å®ç°

1.ä½¿ç”¨ä¸€ä¸ªMap å¯¹è±¡æ¥å­˜å‚¨é”®å€¼å¯¹

2.ä½¿ç”¨ä¸€ä¸ªåŒå‘é“¾è¡¨ç»´æŠ¤é”®å€¼å¯¹çš„é¡ºåº

3.æŠ½ç¦»å‡ºä¸€ä¸ªaddToTaill æ–¹æ³•ï¼ˆå°†èŠ‚ç‚¹æ’å…¥æœ«å°¾ï¼‰æŠ½ç¦»å‡ºä¸€ä¸ªremove æ–¹æ³•ï¼ˆåˆ é™¤èŠ‚ç‚¹ï¼‰

4.å½“æ‰§è¡Œput æ“ä½œæ—¶ï¼Œåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦åœ¨mapä¸­

- å¦‚æœå­˜åœ¨ï¼Œè·å–å½“å‰èŠ‚ç‚¹å€¼ï¼Œåœ¨åŒå‘é“¾è¡¨ä¸­removeåˆ é™¤æ”¹èŠ‚ç‚¹ï¼Œé‡æ–°è°ƒç”¨ addToTail æ·»åŠ åˆ°æœ«å°¾
- å¦‚æœä¸å­˜åœ¨ï¼Œå»ºç«‹ä¸€ä¸ªåŒå‘é“¾è¡¨èŠ‚ç‚¹ï¼Œè°ƒç”¨ addToTail æ·»åŠ åˆ°æœ«å°¾ï¼ŒåŒæ—¶æ·»åŠ è¿›map
- å¦‚æœè¶…è¿‡å®¹é‡this.size > this.capï¼Œåˆ é™¤å½“å‰headèŠ‚ç‚¹ï¼Œä»mapä¸­åˆ é™¤å½“å‰key

5.å½“æ‰§è¡Œget æ“ä½œæ—¶ï¼Œåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦åœ¨mapä¸­

- å¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›-1
- å¦‚æœå­˜åœ¨ï¼Œè·å–å½“å‰key,valueï¼Œé‡æ–°æ‰§è¡Œput æ“ä½œ

```js
class ListNode {
  constructor(key, value) {
    this.key = key;
    this.val = value;
    this.prev = null;
    this.next = null;
  }
}

class LRUCache {
  constructor(capacity = 10) {
    this.capacity = capacity;
    // å®é™…ä¿å­˜çš„é”®å€¼å¯¹æ•°é‡
    this.size = 0;
    this.map = {};
    //ä»£è¡¨æœ€æ—§çš„èŠ‚ç‚¹
    this.head = null;
    //ä»£è¡¨æœ€æ–°çš„èŠ‚ç‚¹
    this.tail = null;
  }

  get(key) {
    const node = this.map.get(key);
    if (!node) return -1;
    let node = this.map[key];
    this.put(node.key, node.val);
    return node.value;
  }

  put(key, value) {
    if(this.map[key]) {
    	let node = this.map[key]
      node.val = value
      this.remove(node)
      this.addTotail(node)
    } else {
      let node = new ListNode(key,value)
      this.addTotail(node)
      this.map[key] = node
      this.size++
    }
    if (this.size > this.cap) {
      let key = this.head.key;
      this.remove(this.head);
      delete this.map[key];
      this.size--;
    }
  }
  addToTail(node) {
    if(this.tail) {
      this.tail.next = node
      node.prev = this.tail
      this.tail = node
    } else {
      this.tail = node
      this.head = node
    }
  }
  remove(node) {
    if(node.prev) {
      node.prev.next = node.next
    } else {
      this.head = this.head.next
    }
    if(node.next) {
      node.next.prev = node.prev
    } else {
      this.tail = this.tail.prev
    }
    node.prev = node.next = null;
  }
}
```



## LFU

â€‹	`Least Frequently Used`æœ€è¿‘ä¸ç»å¸¸ä½¿ç”¨

```js
/**
 * @param {number} capacity
 */
var LFUCache = function (capacity) {
    this.map = new Map();// å­˜æ”¾ key:node çš„ç´¢å¼•ï¼Œä¾¿äºå¿«é€Ÿè®¿é—®èŠ‚ç‚¹
    this.freqArr = new Array() // å®šä¹‰ä¸€ä¸ªé¢‘æ¬¡æ•°ç»„ï¼Œå­˜æ”¾ä¸€ä¸ªåŒå‘é“¾è¡¨
    this.capacity = capacity  // å¯ä»¥ä¿å­˜çš„å®¹é‡
    this.minFreq = 1 // æ–¹ä¾¿æ‰¾åˆ°è®¿é—®æ¬¡æ•°æœ€å°çš„åŒå‘é“¾è¡¨ï¼Œé»˜è®¤è®¾ç½®ä¸º 1
    this.freqArr.push(new DoubleLink())// æ’å…¥ä¸€ä¸ªåŒå‘é“¾è¡¨
    this.freqArr.push(new DoubleLink())// æ’å…¥ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå› ä¸º minFreq é»˜è®¤è®¾ç½®ä¸ºäº† 1ï¼Œæ‰€ä»¥è¦pushä¸¤æ¬¡
};

/** 
 * @param {number} key
 * @return {number}
 */
// è®¿é—®
LFUCache.prototype.get = function (key) {
    const node = this.map.get(key); // è·å–åŒå‘é“¾è¡¨çš„ node èŠ‚ç‚¹
    if (node) {
        this._updateFreq(node) // å¦‚æœèŠ‚ç‚¹å­˜åœ¨ï¼Œåˆ™æ›´æ–°é¢‘æ¬¡
        return node.value  // å¹¶è¿”å› nodeèŠ‚ç‚¹å€¼
    }
    return -1 // å¦åˆ™è¿”å›-1
};

/** 
 * @param {number} key 
 * @param {number} value
 * @return {void}
 */
// è®¾ç½®
LFUCache.prototype.put = function (key, value) {
    if (this.capacity <=0 ) return  // å¦‚æœå®¹é‡è®¾ç½®ä¸º<=0ï¼Œåˆ™ç›´æ¥é€€å‡º
    const node = this.map.get(key) // è·å– node èŠ‚ç‚¹
    if (node) { 
        // å¦‚æœèŠ‚ç‚¹å€¼å­˜åœ¨ï¼Œåˆ™æ›´æ–°é¢‘æ¬¡
        this._updateFreq(node)
        // å¹¶è®¾ç½®èŠ‚ç‚¹çš„å€¼ä¸ºæœ€æ–°çš„å€¼
        node.value = value
        return true
    }
    // å¦‚æœå½“å‰å®¹é‡>=è®¾å®šå®¹é‡
    if (this.map.size >= this.capacity) {
        // è·å–å½“å‰æœ€å°é¢‘æ¬¡ä¸‹åŒå‘é“¾è¡¨ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹,å¹¶åˆ é™¤
        const lastNode = this.freqArr[this.minFreq].pop()
        // åˆ é™¤ map ç»´æŠ¤çš„è¯¥èŠ‚ç‚¹çš„ key 
        this.map.delete(lastNode.key)
    }
    // åˆ›å»ºæ–°çš„åŒå‘é“¾è¡¨èŠ‚ç‚¹
    const newNode = new DoubleLinkNode(key, value)
    // ç”±äºæ˜¯æ–°åˆ›å»ºèŠ‚ç‚¹ï¼Œåˆ™ç¬¬ä¸€æ¬¡é¢‘æ¬¡ä¸º 1ï¼Œè·å–é¢‘æ¬¡ä¸º 1 çš„åŒå‘é“¾è¡¨ï¼Œå¹¶åœ¨æœ€å‰é¢æ’å…¥æ–°èŠ‚ç‚¹
    this.freqArr[1].unshift(newNode)
    // ä¸ç®¡ä¹‹å‰æœ€å°é¢‘æ¬¡åˆ°å‡ ï¼Œè¿™é‡Œé‡ç½®ä¸º 1
    this.minFreq = 1
    // map ä¸­æ–°å¢ key:node æ˜ å°„
    this.map.set(key, newNode)
};
// æ›´æ–°èŠ‚ç‚¹é¢‘æ¬¡
LFUCache.prototype._updateFreq = function (node) {
    // è·å–èŠ‚ç‚¹é¢‘æ¬¡
    const freq = node.freq
    // ç»™èŠ‚ç‚¹ä¸­çš„é¢‘æ¬¡å˜é‡+1
    node.incFreq() 
    // åˆ é™¤åŸé¢‘æ¬¡å¯¹åº”çš„åŒå‘é“¾è¡¨ä¸­çš„è¯¥èŠ‚ç‚¹
    this.freqArr[freq].del(node)
    // è·å–+1 åçš„é¢‘æ¬¡æ•°
    const newFreq = freq + 1
    // å¦‚æœé¢‘æ¬¡æ•°ç»„å¯¹åº”çš„æ–°çš„é¢‘æ¬¡æ•°çš„ç´¢å¼•ä¸‹æ²¡æœ‰èŠ‚ç‚¹
    if (!this.freqArr[newFreq]) {
        // åˆ™ç»™è¯¥é¢‘æ¬¡æ•°ä¸‹èµ‹å€¼ä¸ºæ–°çš„åŒå‘é“¾è¡¨
        this.freqArr[newFreq] = new DoubleLink()
    }
    // å¦åˆ™ï¼Œç›´æ¥è·å–å¯¹åº”é¢‘æ¬¡æ•°ä¸‹çš„åŒå‘é“¾è¡¨ï¼Œå¹¶åœ¨å¼€å¤´æ’å…¥æ–°èŠ‚ç‚¹
    this.freqArr[newFreq].unshift(node)
    // æœ€å°è®¿é—®æ¬¡æ•°ç­‰äºfreqï¼Œå¹¶ä¸”freqçš„åŒå‘é“¾è¡¨æŒ‡å‘ä¸ºç©ºï¼Œè¯æ˜éœ€è¦æ›´æ–°æœ€å°è®¿é—®æ¬¡æ•°ä¸ºæœ€æ–°çš„è®¿é—®æ¬¡æ•°ï¼Œé¿å…åŸé¢‘æ¬¡ä¸‹èŠ‚ç‚¹åˆ é™¤åå¯¹åº”çš„èŠ‚ç‚¹å·²ä¸å­˜åœ¨
    if (freq === this.minFreq && this.freqArr[freq].size === 0) {
        this.minFreq = newFreq
    }
}
// åŒå‘é“¾è¡¨èŠ‚ç‚¹
var DoubleLinkNode = function (key, value) {
    this.key = key
    this.value = value
    this.freq = 1
    this.prev = null
    this.next = null
}
// æ›´æ–°åŒå‘é“¾è¡¨èŠ‚ç‚¹çš„é¢‘æ¬¡æ•°ï¼Œ+1
DoubleLinkNode.prototype.incFreq = function () {
    this.freq++
}
// åŒå‘é“¾è¡¨
var DoubleLink = function () {
    this.head = new DoubleLinkNode(-1, -1) // åˆ›å»ºå¤´éƒ¨èŠ‚ç‚¹
    this.tail = new DoubleLinkNode(-1, -1) // åˆ›å»ºå°¾éƒ¨èŠ‚ç‚¹
    this.head.next = this.tail // å°†å¤´éƒ¨èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘å°¾éƒ¨èŠ‚ç‚¹
    this.tail.prev = this.head // å°†å°¾éƒ¨èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆæŒ‡å‘å¤´éƒ¨èŠ‚ç‚¹
    this.size = 0 // ç”±äºåªæœ‰å¤´å°¾ï¼Œè¿˜æ²¡æœ‰æ’å…¥èŠ‚ç‚¹ï¼Œsize è®¾ä¸º 0
}
// åŒå‘é“¾è¡¨çš„å¼€å¤´æ’å…¥æ–°èŠ‚ç‚¹æ–¹æ³•
DoubleLink.prototype.unshift = function (node) {
    const tmp = this.head.next
    this.head.next = node
    node.next = tmp
    node.prev = this.head
    tmp.prev = node
    this.size++ // è®°å¾—æ›´æ”¹èŠ‚ç‚¹é•¿åº¦
}
// åŒå‘é“¾è¡¨åˆ é™¤èŠ‚ç‚¹æ–¹æ³•
DoubleLink.prototype.del = function (node) {
    const prev = node.prev
    const next = node.next
    prev.next = next
    next.prev = prev
    delete node.prev
    delete node.next
    this.size-- // è®°å¾—æ›´æ”¹èŠ‚ç‚¹é•¿åº¦
}
// åŒå‘é“¾è¡¨ä»é»˜è®¤åˆ é™¤èŠ‚ç‚¹å¹¶è¿”å›è¯¥èŠ‚ç‚¹çš„æ–¹æ³•
DoubleLink.prototype.pop = function () {
    const lastNode = this.tail.prev
    this.del(lastNode)
    return lastNode
}
```

